
# Fix Google OAuth "Access Denied" Error

## Problem Summary

A user experienced an "access denied" error when trying to create an account using their Gmail. This is happening because the Google OAuth implementation is incorrectly configured for Lovable Cloud.

## Root Cause

The current implementation uses:
```typescript
// In src/hooks/useAuth.tsx (line 161-168)
const signInWithGoogle = async () => {
  const { error } = await supabase.auth.signInWithOAuth({
    provider: 'google',
    options: {
      redirectTo: `${window.location.origin}/my-quests`
    }
  });
  return { error: error as Error | null };
};
```

This directly calls the Supabase OAuth flow, but since the project is on **Lovable Cloud**, it must use the managed OAuth solution instead.

---

## Solution

### Step 1: Configure Lovable Cloud Social Auth

Use the `supabase--configure-social-auth` tool to:
- Generate the `src/integrations/lovable/index.ts` module
- Install the `@lovable.dev/cloud-auth-js` package
- Set up managed Google OAuth

### Step 2: Update the Auth Hook

Modify `src/hooks/useAuth.tsx` to use the Lovable Cloud auth:

```typescript
// Add import
import { lovable } from "@/integrations/lovable/index";

// Update signInWithGoogle function
const signInWithGoogle = async () => {
  const { error } = await lovable.auth.signInWithOAuth("google", {
    redirect_uri: window.location.origin,
  });
  return { error: error as Error | null };
};
```

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/hooks/useAuth.tsx` | Import lovable module, update `signInWithGoogle()` to use `lovable.auth.signInWithOAuth()` |

## Files to Generate (via tool)

| File | Generated By |
|------|--------------|
| `src/integrations/lovable/index.ts` | `configure-social-auth` tool |

---

## Technical Details

### Why Lovable Cloud Managed OAuth?

Lovable Cloud automatically manages Google OAuth credentials:
- No need to create a Google Cloud project
- No need to configure OAuth consent screen
- No need to manage client IDs/secrets
- Redirect URLs are automatically configured

### Key Differences

| Aspect | Current (Broken) | Fixed |
|--------|------------------|-------|
| Import | `supabase` client | `lovable` module |
| Method | `supabase.auth.signInWithOAuth()` | `lovable.auth.signInWithOAuth()` |
| Options | `redirectTo` | `redirect_uri` |
| Provider | `{ provider: 'google' }` | `"google"` as first arg |

---

## Verification Steps

After implementation:
1. Go to the Auth page (`/auth`)
2. Click "Continue with Google"
3. Should redirect to Google OAuth consent screen
4. After authenticating, should redirect back to `/my-quests`
5. User should be logged in with their Google account
